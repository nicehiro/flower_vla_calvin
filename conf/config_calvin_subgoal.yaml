defaults:
  - callbacks: calvin
  - datamodule: calvin_subgoal
  - model: flower_subgoal_calvin
  - override hydra/job_logging: colorlog
  - override hydra/hydra_logging: colorlog

root_data_dir: /data/fywang/Calvin/task_ABC_D/
lang_folder: lang_clip_resnet50

log_dir: /outputs/logs/
slurm: false
seed: 242
device: 'cuda'
batch_size: 8
devices: 4
act_dim: 7

# Proprio history (for VLM injection)
proprio_dims: 7
use_proprio_history: true
proprio_history_len: 5            # frames: t-4, t-3, t-2, t-1, t

# Subgoal head
use_subgoal_head: true
subgoal_horizon: 3                # predict 3 future states
subgoal_interval: 10              # at t+10, t+20, t+30

# Training stage
training_stage: 1                 # 1 = GT subgoals, 2 = predicted
subgoal_loss_weight: 1.0
action_loss_weight: 1.0

obs_dim: 512
goal_dim: 1024  # lang_clip_resnet50 uses 1024-dim embeddings
obs_seq_len: 1
act_seq_len: 10
multistep: 10
p_last_state: 0
gen_img_res: 112
max_epochs: 35
rollout_lh_skip_epochs: 19
num_workers: 12
benchmark_name: calvin_d
use_extracted_rel_actions: true

trainer:
  devices: ${devices}
  precision: bf16-mixed
  max_epochs: ${max_epochs}
  sync_batchnorm: True
  accelerator: gpu
  strategy: "ddp"
  limit_train_batches: 1000
  limit_val_batches: 4

logger:
  _target_: pytorch_lightning.loggers.WandbLogger
  save_dir: /output/logs/
  name: logger
  group: mode
  log_model: false
  project: flower
  entity: fywang96
  id: ???

hydra:
  run:
    dir: ${log_dir}/runs/${now:%Y-%m-%d}/${now:%H-%M-%S}_seed${seed}
  sweep:
    dir: ${log_dir}/runs/${now:%Y-%m-%d}/${now:%H-%M-%S}
    subdir: ${hydra.job.override_dirname}
  job:
    config:
      override_dirname:
        exclude_keys:
          - log_dir
          - datamodule.root_data_dir
          - trainer.gpus
          - datamodule.num_workers
          - trainer.limit_train_batches
          - trainer.limit_val_batches
